#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-push hook to check build before pushing to remote
echo "ğŸ” Running pre-push checks..."

# Check if we're pushing to main branch
protected_branch='main'
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

if [ "$current_branch" = "$protected_branch" ]; then
    echo "ğŸ“¦ Building project to check for errors..."
    
    # Run build
    npm run build
    
    if [ $? -ne 0 ]; then
        echo "âŒ Build failed! Please fix errors before pushing."
        exit 1
    fi
    
    echo "âœ… Build successful!"
    
    # Run type check
    echo "ğŸ” Checking TypeScript types..."
    npm run typecheck
    
    if [ $? -ne 0 ]; then
        echo "âŒ TypeScript errors found! Please fix before pushing."
        exit 1
    fi
    
    echo "âœ… TypeScript check passed!"
    
    # Run lint
    echo "ğŸ” Running ESLint..."
    npm run lint
    
    if [ $? -ne 0 ]; then
        echo "âŒ Lint errors found! Please fix before pushing."
        exit 1
    fi
    
    echo "âœ… All checks passed! Pushing to remote..."
else
    echo "ğŸ“ Not on main branch, skipping build checks."
fi