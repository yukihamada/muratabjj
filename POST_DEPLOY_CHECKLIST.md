# デプロイ後チェックリスト

## 🚀 デプロイ完了後の作業

### 1. デプロイURLの確認
- VercelダッシュボードでプロジェクトのURLを確認
- 例: `https://muratabjj.vercel.app`

### 2. Stripe Webhook設定
1. Stripe Dashboard → 開発者 → Webhook
2. 「エンドポイントを追加」
3. URL: `https://[your-vercel-url]/api/stripe/webhook`
4. イベントを選択（STRIPE_SETUP_GUIDE.mdを参照）
5. 署名シークレットをコピー
6. Vercelで環境変数 `STRIPE_WEBHOOK_SECRET` を追加

### 3. 管理者アカウント作成
1. 本番サイトにアクセス
2. 通常のユーザー登録を行う
3. Supabase Dashboard → SQL Editor
4. `/scripts/setup-admin.sql` を実行（メールアドレスを変更）

### 4. 基本動作確認

#### 認証機能
- [ ] ユーザー登録が動作する
- [ ] ログイン/ログアウトが動作する
- [ ] パスワードリセットが動作する

#### ダッシュボード
- [ ] `/dashboard` にアクセスできる
- [ ] プロフィール編集が動作する
- [ ] 言語切り替えが動作する

#### 管理者機能
- [ ] `/admin` にアクセスできる（管理者のみ）
- [ ] ユーザー一覧が表示される
- [ ] コーチ権限の付与/削除が動作する

#### 動画機能（コーチ権限必要）
1. 管理者ダッシュボードで自分にコーチ権限を付与
2. ダッシュボード → 動画 → アップロード
- [ ] 動画アップロードが動作する
- [ ] 動画再生が動作する
- [ ] 再生速度調整が動作する
- [ ] チャプター機能が動作する

#### 決済機能
- [ ] `/dashboard/subscription` にアクセス
- [ ] Proプランの購入ボタンが表示される
- [ ] Stripeの決済画面に遷移する
- [ ] 決済完了後、サブスクリプション状態が更新される

#### その他の機能
- [ ] フローエディタが動作する
- [ ] スパーログが記録できる
- [ ] 習得度トラッキングが動作する
- [ ] PWAとしてインストールできる

### 5. エラーの確認

#### Vercelログ
1. Vercelダッシュボード → Functions タブ
2. エラーログを確認
3. 特に以下をチェック：
   - 環境変数の不足
   - データベース接続エラー
   - API認証エラー

#### ブラウザコンソール
1. 開発者ツールを開く（F12）
2. Consoleタブでエラーを確認
3. Networkタブで失敗したリクエストを確認

### 6. パフォーマンス確認
- [ ] Lighthouse でパフォーマンススコアをチェック
- [ ] 初回読み込み時間が3秒以内
- [ ] 画像が最適化されて配信されている

### 7. セキュリティ確認
- [ ] HTTPS で配信されている
- [ ] 環境変数が公開されていない
- [ ] 管理者以外が `/admin` にアクセスできない
- [ ] RLSポリシーが正しく動作している

## 🐛 よくある問題と解決方法

### 「500 Internal Server Error」
- Vercelのログを確認
- 環境変数が正しく設定されているか確認
- Supabaseの接続情報を再確認

### 「認証エラー」
- Supabase URLとAnon Keyが正しいか確認
- Service Role Keyがサーバーサイドで使用されているか確認

### 「決済が動作しない」
- Stripe APIキーが本番用か確認
- Webhook URLが正しいか確認
- Webhook署名シークレットが設定されているか確認

### 「動画アップロードが失敗する」
- Supabase Storageバケットが作成されているか確認
- ファイルサイズ制限を確認
- CORS設定を確認

## 📞 サポート

問題が解決しない場合：
1. エラーメッセージをコピー
2. Vercelのログをスクリーンショット
3. 実行した操作の手順を記録
4. 上記の情報と共に報告